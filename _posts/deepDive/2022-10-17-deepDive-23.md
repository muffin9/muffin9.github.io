---
permalink: /javascript/deepDive-23
title: "실행 컨텍스트"
categories: JavaScript
tags: deepDive

toc: true
toc_sticky: true


date: 2022-10-24
last_modified_at: 2022-10-24
---

### 실행 컨텍스트란?  

실행 컨텍스트는 자바스크립트의 동작원리를 담고 있는 핵심 개념으로, 소스코드를 실행하는 데 필요한 환경을 제공하고 실행 결과를 실제로 관리하는 영역이다.  
뒤에서 살펴볼거지만, 식별자와 스코프는 실행 컨텍스트 렉시컬 환경으로 관리하고 코드 실행 순서는 실행 컨텍스트 스택으로 관리한다.  
여기서 실행 가능한 코드는 4가지 타입으로 구분되는데 전역코드, 함수 코드, eval 코드, 모듈 코드가 존재한다.  

4가지 타입으로 구분하는 이유는 ? 소스코드의 타입에 따라 실행 컨텍스트를 생성하는 과정과 관리 내용이 다르기 때문.  

전역코드 -> 전역 실행 컨텍스트  

함수 코드 -> 함수 실행 컨텍스트  

eval 코드 -> eval 실행 컨텍스트  

모듈 코드 -> 모듈 실행 컨텍스트  

---

### 소스코드 평가와 실행  

모든 소스코드는 실행에 앞서 평가 과정을 거치며 코드를 실행하기 위한 준비를 한다.  

소스코드 평가 과정에서는 실행 컨텍스트를 생성하고 변수, 함수 등 선언문만 먼저 실행한 다음 생성된 변수나 함수 식별자를 키로 실행 컨텍스트가 관리하는 스코프에 등록.  

소스코드 평가 과정이 끝나면 런타임이 시작되는데 이때 소스코드 실행에 필요한 정보, 변수나 함수의 참조를 실행 컨텍스트가 관리하는 스코프에 검색해서 얻는다.  

변수 값의 변경 등 소스코드의 실행 결과는 다시 실행 컨텍스트가 관리하는 스코프에 등록한다.  

```javascript
var num;
num = 1;
```

위 예제로 소스코드가 어떻게 평가되고 실행되는지 알아보자.  

1. 소스코드 평과 과정에서 변수 선언문 var num;를 먼저 실행한다.  
2. 생성된 변수 식별자 num은 실행 컨텍스트가 관리하는 스코프에 등록되고 undefined로 초기화된다.  
3. 소스코드 평가 과정이 끝나면 소스코드 실행 과정에서는 변수 할당문 num = 1;만 실행된다.  
4. 실행 컨텍스트가 관리하는 스코프에 num 변수가 등록되어 있는지 확인하고 등록되어 있다면 값을 할당하고 할당 결과를 실행 컨텍스트에 등록하여 관리.  

---

### 실행 컨텍스트 스택  

```javascript
const x = 1;

function foo () {
    const y = 2;

    function bar () {
        const z = 3;
        console.log(x + y + z);
    }
    bar();
}

foo();
```

![]()  

실행 컨텍스트 스택이란 ? 소스코드가 실행되는 시간의 흐름에 따라 관리되는 자료구조다.  

위 코드가 어떤식으로 평가되고 실행되는지 살펴보자  

1. 전역 코드 평가와 실행 : 자바스크립트 엔진은 먼저 전역 코드를 평가하여 전역 실행 컨텍스트를 생성하고 실행 컨텍스트 스택에 푸시한다. (전역변수 x, 전역함수 foo가 전역 실행 컨텍스트에 등록.) 이후 전역 코드가 실행되기 시작하여 전역 변수 x에 값이 할당되고, 전역 함수 foo가 호출  

2. foo 함수 코드 평가와 실행 : 전역 함수 foo가 호출될시 전여겨 코드 실행이 중단되고 코드의 제어권이 foo 함수 내부로 이동한다. 이후 foo 함수 내부 함수 코드를 평가하여 foo 함수 실행 컨텍스트를 생성하고 실행 컨텍스트 스택에 푸시한다. 그 다음엔 foo 함수 지역 변수 y, 중첩 함수 bar가 foo 함수 실행 컨텍스트에 등록되고 foo 함수 코드가 실행되기 시작하여 지역 변수 y에 값이 할당되고 중ㅇ첩 함수 bar가 호출.

3. bar 함수 코드 평가와 실행 : 중첩 함수 bar가 호출될시 foo 함수 코드 실행은 일시 중단되고 코드 제어권이 bar 함수 내부로 이동한다. 이후 bar 함수 내부 코드를 평가하여 bar 함수 실행 컨텍스트를 생성하고 실행 컨텍스트 스택에 푸시한다. 그 다음엔 bar 함수 지역 변수 z가 실행 컨텍스트에 등록되고 bar 함수 코드가 실행되기 시작하여 지역 변수 z에 값이 할당되고 console.log 메서드가 호출되며 bar 함수 종료.

4. foo 함수 코드로 복귀 : 다시 foo 함수 코드로 복귀하여 foo 함수는 더이상 실행할 코드가 없기 때문에 종료.  

5. 전역 코드로 복귀 : 전역 코드로 복귀하는데 전역 코드에도 더이상 실행할 코드가 없어서 종료된다.  


---

### 렉시컬 환경  

렉시컬 환경은 키와 값을 갖는 객체 형태의 스코프를 생성하여 식별자를 키로 등록하고 식별자에 바인딩된 값을 관리합니다. 즉 렉시컬 환경은 스코프를 구분하여 식별자를 등록하고 관리하는 저장소 역할을 하는 렉시컬 스코프의 실체입니다.  

렉시컬 환경은 다음과 같이 두개의 컴포넌트로 구성된다.  

1. EnvironmentRecord(환경 레코드) : 스코프에 포함된 식별자를 등록하고 등록된 식별자에 바인딩된 값을 관리하는 저장소

2. OuterLexicalEnvironmentReference(외부 렉시컬 환경에 대한 참조) : 해당 실행 컨텍스트를 생성한 상위 스코프를 가리킨다.

---


```javascript
var x = 1;
const y = 2;

function foo (a) {
    var x = 3;
    const y = 4;

    function bar (b) {
        const z = 5;
        console.log(a + b + x + y + z);
    }
    bar(10);
}
foo(20);
```

### 전역 코드 평가  

1. 전역 실행 컨텍스트 생성
2. 전역 렉시컬 환경 생성(전역 실행 컨텍스트에 바인딩)  
    - 전역 환경 레코드 생성(객체 환경 레코드 생성 / 선언적 환경 레코드 생성)
    - this 바인딩
    - 외부 렉시컬 환경에 대한 참조 결정

### 전역 코드 실행  

### foo 함수 코드 평가  

전역 실행 컨텍스트가 생성되었고 전역 코드가 실행되어 있는 상태 -> foo 함수 내부로 코드 제어권 이동.  

1. foo 함수 실행 컨텍스트 생성
2. foo 함수 렉시컬 환경 생성
    - 함수 환경 레코드 생성
    - this 바인딩
    - 외부 렉시컬 환경에 대한 참조 결정

### foo 함수 코드 실행  

실행중인 실행 컨텍스트의 렉시컬 환경에서 식별자(변수 x, y)를 검색하여 찾음 -> 검색된 식별자에 값을 바인딩  

### bar 함수 코드 평가  

bar 함수 내부로 코드 제어권 이동. 

1. bar 함수 실행 컨텍스트 생성
2. bar 함수 렉시컬 환경 생성
    - 함수 환경 레코드 생성
    - this 바인딩
    - 외부 렉시컬 환경에 대한 참조 결정  

### bar 함수 코드 실행  

bar 함수 현재 실행 컨텍스트의 렉시컬환경에서 식별자 z에 값이 할당, 콘솔로그 찍힘 => 콘솔로그는 스코프 체인을 따라 상위까지 살펴보면서 객체 환경 레코드 BindingObject를 통해 전역 객체에서 찾을 수 있음.  
이 말은 console.log를 많이 사용하게 된다면 상위 스코프를 탐색하는 비용이 많아짐 -> 많이 사용하게 되면 성능 저하를 일으킬 수 있다.  

### bar 함수 코드 실행 종료 -> foo 함수 코드 실행 종료 -> 전역 코드 실행 종료.



